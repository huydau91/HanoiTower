<!DOCTYPE html>
<html>
<head>
	<title>Test OOP</title>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
	<script src="js/jquery-3.2.1.min.js"></script>
	<script src="js/d3.js"></script>
</head>
<body style="background: #d9edf7;">
	<div class="container" style="margin-top: 3rem;">
		<div style="text-align: center; margin-bottom: 5rem;">
			<p style="text-transform: uppercase; font-size: 3rem; margin-bottom: 4rem;">hanoi towers</p>
			<input>
			<button onclick="callbuild()">Create Tower</button>
			<button onclick="callmove()">Start</button>
		</div>
	</div>

	<script type="text/javascript">
		let svg = '';
		let biggest_disk = $(".container").width()/4;
		let margin = biggest_disk + biggest_disk/2;
		let unit_disk = '';
		let disk = [];
		let tower_height = ''; tower1=tower2=tower3= '';
		let disks = ''; n = '';
		let i = 1;

		class Disk {
			constructor(n){
				this.n = n;
			}

			build_disk(){
				unit_disk = biggest_disk/n;
				for (var i = 1; i<=n; i++){
					svg.append("rect")
					.attr("x", function(){
						return (n-i)*(unit_disk/2);
					})
					.attr("y", function(){
						return i*40+100;
					})
					.attr("width", function(){
						return i*unit_disk;
					})
					.attr("height",40)
					.attr("rx",10)
					.attr("ry",10)
					.attr("stroke-width", 1)
					.attr("stroke", "rgba(0,0,0,.5)")
					.classed("disk" + i + " color", true);

					disk.push(d3.select(".disk" + i));
				}

				d3.selectAll(".color").style("fill", function() {
					return "hsl(" + Math.random() * 360 + ",100%,50%)";
				});
			}
		}

		class Tower {
			build_tower(){
				for (var j=0; j<3; j++){
					svg.append("rect")
					.attr("x", function(){
						return j*margin + (biggest_disk/2) - 10;
					})
					.attr("y", 140)
					.attr("rx", 10)
					.attr("ry", 10)
					.attr("width", 20)
					.attr("height", n*40)
					.attr("fill", "rgba(105, 105, 105, 0.8)");
				}
				for (var j=0; j<3; j++){
					svg.append("rect")
					.attr("x", function(){
						return j*margin;
					})
					.attr("y", n*40+140)
					.attr("rx", 10)
					.attr("ry", 10)
					.attr("width", biggest_disk)
					.attr("height", 20)
					.attr("fill", "rgba(105, 105, 105, 0.8)");
				}
			}
		}

		class GameEngine {
			move(n, a, b, c){
				if (n > 0) {
					this.move(n-1, a, c, b);

					if (a == 0 && c == margin){
						disk[n-1]
						.transition()
						.delay(i*2000)
						.transition()
						.duration(750)
						.attr("y", 0)
						.transition()
						.duration(750)
						.attr("x", c+(disks-n)*(unit_disk/2))
						.transition()
						.duration(750)
						.attr("y", tower_height - tower2*40+100);

						tower1--; tower2++;
						// console.log(disk[n-1].attr("x") + " , " + disk[n-1].attr("y"));
						console.log("tower1 " + tower1 + ", tower2 " + tower2);
						i++;
					}

					if (a == 0 && c == 2*margin){
						disk[n-1]
						.transition()
						.delay(i*2000)
						.transition()
						.duration(750)
						.attr("y", 0)
						.transition()
						.duration(750)
						.attr("x", c+(disks-n)*(unit_disk/2))
						.transition()
						.duration(750)
						.attr("y", tower_height - tower3*40+100);

						tower1--; tower3++;
						// console.log(disk[n-1].attr("x") + " , " + disk[n-1].attr("y"))
						console.log("tower1 " + tower1 + ", tower3 " + tower3);
						i++;
					}

					if (a == margin && c == 0){
						disk[n-1]
						.transition()
						.delay(i*2000)
						.transition()
						.duration(750)
						.attr("y", 0)
						.transition()
						.duration(750)
						.attr("x", c+(disks-n)*(unit_disk/2))
						.transition()
						.duration(750)
						.attr("y", tower_height - tower1*40+100);

						tower2--; tower1++;
						// console.log(disk[n-1].attr("x") + " , " + disk[n-1].attr("y"))
						console.log("tower1 " + tower1 + ", tower2 " + tower2);
						i++;
					}

					if (a == margin && c == 2*margin){
						disk[n-1]
						.transition()
						.delay(i*2000)
						.transition()
						.duration(750)
						.attr("y", 0)
						.transition()
						.duration(750)
						.attr("x", c+(disks-n)*(unit_disk/2))
						.transition()
						.duration(750)
						.attr("y", tower_height - tower3*40+100);

						tower2--; tower3++;
						// console.log(disk[n-1].attr("x") + " , " + disk[n-1].attr("y"))
						console.log("tower2 " + tower2 + ", tower3 " + tower3);
						i++;
					}

					if (a == 2*margin && c == margin){
						disk[n-1]
						.transition()
						.delay(i*2000)
						.transition()
						.duration(750)
						.attr("y", 0)
						.transition()
						.duration(750)
						.attr("x", c+(disks-n)*(unit_disk/2))
						.transition()
						.duration(750)
						.attr("y", tower_height - tower2*40+100);

						tower2++; tower3--;
						// console.log(disk[n-1].attr("x") + " , " + disk[n-1].attr("y"))
						console.log("tower2 " + tower2 + ", tower3 " + tower3);
						i++;
					}

					if (a == 2*margin && c == 0){
						disk[n-1]
						.transition()
						.delay(i*2000)
						.transition()
						.duration(750)
						.attr("y", 0)
						.transition()
						.duration(750)
						.attr("x", c+(disks-n)*(unit_disk/2))
						.transition()
						.duration(750)
						.attr("y", tower_height - tower1*40+100);

						tower1++; tower3--;
						// console.log(disk[n-1].attr("x") + " , " + disk[n-1].attr("y"))
						console.log("tower1 " + tower1 + ", tower3 " + tower3);
						i++;
					}

					console.log("Move disk " + n + " from " + a + " to " + c);

					this.move(n-1, b, a, c);
				}
			}
		}

		function callbuild(){
			d3.selectAll("svg").remove();
			n = $('input').val();
			disk = []; tower2=tower3 = ''; i = 1;
			svg = d3.select(".container").append("svg").attr("width", $(".container").width()).attr("height", $(window).height());
			tower_height = n*40;
			tower1 = disks = n;
			let build_disk = new Disk(n);
			let build_tower = new Tower();
			build_tower.build_tower();
			build_disk.build_disk();
		}

		function callmove(){
			n = $('input').val();
			let move = new GameEngine();
			move.move(n, 0, margin, 2*margin);
		}
	</script>
</body>
</html>